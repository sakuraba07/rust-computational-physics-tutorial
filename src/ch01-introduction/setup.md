# 開発環境のセットアップ

本章では、Rustによる計算物理学を始めるための開発環境をセットアップします。本書の想定読者は既にRustの基本文法を理解している方を対象としているため、既にRustをインストール済みの方も多いと思います。そのような方は、バージョン確認のセクションから読み進めていただいて構いません。

Rustをまだインストールしていない方、または環境を見直したい方のために、標準的なセットアップ手順も説明します。

## Rustのインストール

Rustをまだインストールしていない方は、[Rust公式サイト](https://www.rust-lang.org/ja/tools/install)を参照してインストールを行ってください。公式サイトでは、お使いのOS（Windows、macOS、Linux）に応じた最新のインストール手順が案内されています。

Rustの公式インストーラである**rustup**を使用することで、Rustのバージョン管理、コンパイラやツールチェーンの更新を簡単に行えます。

### インストールの確認

Rustが正しくインストールされているか確認するために、以下のコマンドを実行します。

```bash
rustc --version
cargo --version
```

これらのコマンドがRustのバージョン情報を表示すれば、インストールは成功しています。

`rustc`はRustのコンパイラ、`cargo`はRustのビルドツールおよびパッケージマネージャです。本書では主に`cargo`を使用してプロジェクトを管理します。

### Rustのバージョンについて

本書では、Rust stable版の最新バージョンを使用することを推奨します。Rustは6週間ごとに新しいstable版がリリースされますが、後方互換性が非常に重視されているため、多くの場合、古いバージョンでも問題なく動作します。

ただし、本書のコード例は執筆時点（2025年）の最新機能を使用している場合があります。もし古いバージョンのRustを使用していてコンパイルエラーが発生する場合は、以下のコマンドで最新版に更新してください。

```bash
rustup update
```

特定のバージョンを使用したい場合は、以下のようにバージョンを指定することもできます。

```bash
rustup install 1.91.1
rustup default 1.91.1
```

## 開発環境の確認

それでは、実際に簡単なプログラムを作成して、開発環境が正しく動作することを確認しましょう。ここでは、本書のテーマに沿って、簡単な数値計算を行うプログラムを作成します。

### プロジェクトの作成

まず、新しいプロジェクトを作成します。適当なディレクトリで以下のコマンドを実行してください。
なお、`physics_test`の部分は任意のプロジェクト名に変更して構いません。

```bash
cargo new physics_test
cd physics_test
```

`cargo new`コマンドは、新しいRustプロジェクトのひな形を生成します。`physics_test`という名前のディレクトリが作成され、その中に以下のような構造が生成されます。

```
physics_test/
├── Cargo.toml     # プロジェクトの設定ファイル
└── src/
    └── main.rs    # メインのソースコード
```

### 簡単な数値計算プログラムの作成

`src/main.rs`を開いて、以下のコードを入力してください。このプログラムは、自由落下する物体の位置を計算します。

```rust:main.rs
fn main() {
    // 物理定数
    let g = 9.8; // 重力加速度 [m/s^2]
    let v0 = 0.0; // 初速度 [m/s]
    let h0 = 100.0; // 初期高度 [m]

    println!("自由落下シミュレーション");
    println!("初期高度: {} m", h0);
    println!("重力加速度: {} m/s^2", g);
    println!();

    // 時刻ごとの位置を計算
    println!("時刻[s]  高度[m]  速度[m/s]");
    println!("================================");

    for i in 0..=10 {
        let t = i as f64 * 0.5; // 0.5秒刻み
        let v = v0 - g * t; // 速度 v = v0 - gt
        let h = h0 + v0 * t - 0.5 * g * t * t; // 位置 h = h0 + v0*t - (1/2)*g*t^2

        if h >= 0.0 {
            println!("{:6.1}  {:7.2}  {:9.2}", t, h, v);
        } else {
            // 地面に到達したら計算終了
            let t_impact = (v0 + (v0 * v0 + 2.0 * g * h0).sqrt()) / g;
            let v_impact = v0 - g * t_impact;
            println!("{:6.2}  {:7.2}  {:9.2} (地面到達)", t_impact, 0.0, v_impact);
            break;
        }
    }
}
```

このプログラムは、以下の物理法則を使用しています。

- 速度：$v (t) = v_0 - g t$
- 位置：$h (t) = h_0 + v_0 t - 1/2 g t^2$

ここで、$g$は重力加速度、$v_0$は初速度、$h_0$は初期高度です。

### プログラムの実行

プロジェクトのルートディレクトリ（`Cargo.toml`があるディレクトリ）で、以下のコマンドを実行します。

```bash
cargo run
```

初回実行時は、コンパイルが行われます。コンパイルが完了すると、プログラムが自動的に実行され、以下のような出力が表示されます。

```
自由落下シミュレーション
初期高度: 100 m
重力加速度: 9.8 m/s^2

時刻[s]  高度[m]  速度[m/s]
================================
   0.0   100.00       0.00
   0.5    98.78      -4.90
   1.0    95.10      -9.80
   1.5    88.98     -14.70
   2.0    80.40     -19.60
   2.5    69.38     -24.50
   3.0    55.90     -29.40
   3.5    39.98     -34.30
   4.0    21.60     -39.20
   4.5     0.78     -44.10
   4.52     0.00     -44.29 (地面到達)
```

このような出力が得られれば、開発環境は正しくセットアップされています。

### コードの説明

上記のコードでは、Rustの基本的な機能をいくつか使用しています。

- **変数の宣言**：`let`キーワードで変数を宣言します。Rustではデフォルトで変数はイミュータブル（不変）です
- **浮動小数点数**：`f64`型（64ビット浮動小数点数）を使用しています。型は推論されるため、明示的に書く必要はありません
- **ループ**：`for`ループで時間ステップを進めています
- **型変換**：`i as f64`で整数を浮動小数点数に変換しています
- **条件分岐**：`if`文で地面到達を判定しています
- **書式付き出力**：`println!`マクロで、`{:6.1}`のような書式指定子を使って、整列された出力を行っています

このプログラムは非常にシンプルですが、計算物理学の基本的な要素を含んでいます。

- 物理法則の数式化
- 時間発展のシミュレーション
- 結果の出力と可視化（ここでは簡易的なテキスト出力）

本書では、これらの要素をより発展させ、複雑な物理現象をシミュレートしていきます。

## エディタとIDE

Rustのコードを書くためのエディタやIDEは、ご自身の好みに応じて選択してください。

どのエディタを選んでも、**rust-analyzer**によるコード補完、エラーチェック、リファクタリング支援が利用できることを確認してください。rust-analyzerは、Rustの公式な言語サーバープロトコル（LSP）実装で、最新のRust言語機能をサポートしています。

## 次のステップ

開発環境のセットアップが完了しました。次の章では、数値計算の基礎として、浮動小数点演算や配列操作について学びます。また、本書で頻繁に使用する外部クレート（`ndarray`など）の基本的な使い方も習得します。

本書のコード例は、基本的に以下の手順で実行できます。

1. `cargo new project_name`で新しいプロジェクトを作成
2. 必要なクレートを`Cargo.toml`の`[dependencies]`セクションに追加
3. `src/main.rs`にコードを記述
4. `cargo run`で実行

各章では、具体的なコード例とともに、必要な依存関係も明示します。

## トラブルシューティング

もしインストールや実行時に問題が発生した場合は、[付録C: デバッグとトラブルシューティング](../appendix/c-debugging.md)を参照してください。よくある問題とその解決方法がまとめられています。

また、Rust公式のドキュメントも非常に充実しています。

- [The Rust Programming Language（日本語版）](https://doc.rust-jp.rs/book-ja/)：Rustの公式チュートリアル
- [Rust By Example（日本語版）](https://doc.rust-jp.rs/rust-by-example-ja/)：実例で学ぶRust
- [The Cargo Book](https://doc.rust-lang.org/cargo/)：Cargoの公式ドキュメント

それでは、Rustによる計算物理学の旅を始めましょう！
