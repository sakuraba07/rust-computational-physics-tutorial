# 開発環境のセットアップ

本章では、Rustによる計算物理学を始めるための開発環境をセットアップします。本書の想定読者は既にRustの基本文法を理解している方を対象としているため、既にRustをインストール済みの方も多いと思います。そのような方は、本章を読み飛ばしていただいて構いません。

Rustをまだインストールしていない方、または環境を見直したい方のために、標準的なセットアップ手順を説明します。

## Rustのインストール

Rustをまだインストールしていない方は、[Rust公式サイト](https://www.rust-lang.org/ja/tools/install)の案内に従ってインストールを行ってください。公式サイトでは、お使いのOS（Windows, macOS, Linux）に応じた最新のインストール手順が案内されています。

Rust公式のツールチェーン管理ツールである**rustup**を使用することで、Rustコンパイラのバージョン管理や、関連ツールの更新が簡単に行えます。

### インストールの確認

Rustが正しくインストールされているか確認するために、ターミナルで以下のコマンドを実行します。

```bash
rustc --version
cargo --version
```

これらのコマンドがそれぞれのバージョン情報を表示すれば、インストールは成功しています。

- `rustc`: Rustのコンパイラ
- `cargo`: Rustのビルドツール兼パッケージマネージャ

本書では、主に`cargo`を使用してプロジェクトの作成や管理を行います。

### Rustのバージョンについて

本書では、Rustの安定版（stable版）の最新バージョンを使用することを推奨します。Rustは6週間ごとに新しい安定版がリリースされますが、後方互換性が非常に重視されているため、多くの場合、古いバージョンでも本書のコードは問題なく動作します。

ただし、コード例は執筆時点（2025年）の最新機能を使用している可能性があります。もし古いバージョンのRustを使用していてコンパイルエラーが発生した場合は、以下のコマンドで最新版に更新してみてください。

```bash
rustup update
```

また、特定のバージョン（例えば `1.91.1`）をインストールして使用したい場合は、以下のように指定することもできます。

```bash
rustup install 1.91.1
rustup default 1.91.1
```

## 開発環境の確認

それでは、実際に簡単なプログラムを作成し、開発環境が正しく動作することを確認しましょう。ここでは、本書のテーマに合わせて、簡単な数値計算を行うプログラムを作成します。

### プロジェクトの作成

まず、新しいプロジェクトを作成します。任意のディレクトリで以下のコマンドを実行してください（`physics_test`の部分は好きなプロジェクト名に変更して構いません）。

```bash
cargo new physics_test
cd physics_test
```

`cargo new`コマンドは、新しいRustプロジェクトの雛形を生成します。`physics_test`という名前のディレクトリが作成され、その中に以下のようなファイル構造が生成されます。

```
physics_test/
├── Cargo.toml     # プロジェクトの設定ファイル（依存関係など）
└── src/
    └── main.rs    # メインのソースファイル
```

### 簡単な数値計算プログラムの作成

`src/main.rs`を開き、エディタで以下のコードに書き換えてください。このプログラムは、自由落下する物体の時間ごとの位置と速度を計算します。

```rust:main.rs
fn main() {
    // 物理定数
    let g = 9.8; // 重力加速度 [m/s^2]
    let v0 = 0.0; // 初速度 [m/s]
    let h0 = 100.0; // 初期高度 [m]

    println!("自由落下シミュレーション");
    println!("初期高度: {} m", h0);
    println!("重力加速度: {} m/s^2", g);
    println!();

    // 時刻ごとの位置と速度を計算
    println!("時刻[s]  高度[m]  速度[m/s]");
    println!("================================");

    for i in 0..=10 {
        let t = i as f64 * 0.5; // 0.5秒刻み
        let v = v0 - g * t; // 速度 v = v0 - gt
        let h = h0 + v0 * t - 0.5 * g * t * t; // 位置 h = h0 + v0*t - (1/2)*g*t^2

        if h >= 0.0 {
            println!("{:6.1}  {:7.2}  {:9.2}", t, h, v);
        } else {
            // 地面に到達したら、正確な到達時刻と速度を計算して終了
            let t_impact = (v0 + (v0 * v0 + 2.0 * g * h0).sqrt()) / g;
            let v_impact = v0 - g * t_impact;
            println!("{:6.2}  {:7.2}  {:9.2} (地面到達)", t_impact, 0.0, v_impact);
            break;
        }
    }
}
```

このプログラムは、以下の物理法則に基づいています。

- 速度：$v (t) = v_0 - g t$
- 位置：$h (t) = h_0 + v_0 t - 1/2 g t^2$

ここで、$g$は重力加速度、$v_0$は初速度、$h_0$は初期高度です。

### プログラムの実行

プロジェクトのルートディレクトリ（`Cargo.toml`があるディレクトリ）で、以下のコマンドを実行します。

```bash
cargo run
```

初回実行時はコンパイルが行われ、少し時間がかかります。コンパイルが完了すると、プログラムが自動的に実行され、以下のような出力が表示されるはずです。

```
自由落下シミュレーション
初期高度: 100 m
重力加速度: 9.8 m/s^2

時刻[s]  高度[m]  速度[m/s]
================================
   0.0   100.00       0.00
   0.5    98.78      -4.90
   1.0    95.10      -9.80
   1.5    88.97     -14.70
   2.0    80.40     -19.60
   2.5    69.38     -24.50
   3.0    55.90     -29.40
   3.5    39.97     -34.30
   4.0    21.60     -39.20
   4.5     0.77     -44.10
  4.52     0.00     -44.27 (地面到達)
```

このような出力が得られれば、開発環境は正しくセットアップされています。

### コードの簡単な説明

上記のコードでは、Rustの基本的な機能をいくつか使用しています。

- **変数の宣言**: `let`キーワードで変数を宣言します。Rustでは変数はデフォルトでイミュータブル（不変）です。
- **浮動小数点数**: `f64`型（64ビット浮動小数点数）を使用しています。多くの場合、型はコンパイラによって推論されるため、コード中に明示する必要はありません。
- **ループ**: `for`ループで0.5秒ごとに時間ステップを進めています。
- **型変換**: `i as f64`でループカウンタの整数`i`を浮動小数点数に変換しています。
- **条件分岐**: `if`文で物体が地面に到達したかどうかを判定しています。
- **書式付き出力**: `println!`マクロで、`{:6.1}`のような書式指定子を使い、整列された出力を行っています。

このプログラムは非常にシンプルですが、計算物理学の基本的な要素（物理法則の数式化、時間発展シミュレーション、結果の出力）を含んでいます。本書では、これらの要素をより発展させ、複雑な物理現象をシミュレートしていきます。

## エディタとIDE

Rustのコードを書くためのエディタや統合開発環境（IDE）は、ご自身の好みに応じて選択してください。多くの人気エディタには、Rustをサポートする拡張機能があります。

どのエディタを選ぶ場合でも、**rust-analyzer**のサポートを有効にすることを強く推奨します。**rust-analyzer**は、Rust公式の言語サーバープロトコル（LSP）実装であり、以下のような強力な支援機能を提供します。

- コード補完
- エラーチェックとハイライト
- 定義ジャンプ
- リファクタリング

これにより、開発効率が大幅に向上します。

## 次のステップ

開発環境のセットアップと、簡単な物理シミュレーションの実行が完了しました。しかし、数値の羅列だけでは、結果を直感的に理解するのは困難です。

次の章では、結果をグラフとして可視化する方法を学びます。

## トラブルシューティング

もしインストールや実行時に問題が発生した場合は、[付録C: デバッグとトラブルシューティング](../appendix/c-debugging.md)を参照してください。よくある問題とその解決方法がまとめられています。

また、Rust公式のドキュメントも非常に充実しており、問題解決の助けになります。

- [The Rust Programming Language（日本語版）](https://doc.rust-jp.rs/book-ja/)：Rustの公式入門書（The Book）
- [Rust By Example（日本語版）](https://doc.rust-jp.rs/rust-by-example-ja/)：豊富な実例で学ぶRust
- [The Cargo Book](https://doc.rust-lang.org/cargo/)：Cargoの公式ドキュメント
