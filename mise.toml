[tools]
"cargo:mdbook" = "latest"
"cargo:mdbook-mermaid" = "latest"
# "cargo:mdbook-typst-math" = "latest"
"cargo:https://github.com/sakuraba07/mdbook-typst-math" = "branch:main"
"cargo:mdbook-last-changed" = "latest"
"cargo:pagefind" = { version = "latest", features = "extended" }
"cargo:lychee" = "latest"
"cargo:miniserve" = "latest"

[tasks.clean]
description = "Clean build artifacts"
run = "rm -rf book"

[tasks.build]
description = "Build mdbook and generate search index"
run = """
echo "ğŸ“š Building mdbook..."
mdbook build
echo "âœ… Build completed\n"

echo "ğŸ” Generating search index..."
pagefind --site book --force-language ja --exclude-selectors "nav,.sidebar,.menu-bar,.nav-wrapper,.nav-wide-wrapper,#mdbook-sidebar,#mdbook-menu-bar,.mdbook-help-container"
echo "âœ… Index generated\n"

echo "ğŸ”— Checking links..."
lychee book/
echo "âœ… Links checked\n"

echo "ğŸ‰ Done!"
"""

[tasks.serve]
description = "Build and serve the book with search functionality"
depends = ["build"]
run = """
echo "ğŸš€ Starting server on http://localhost:3000..."
echo "Press Ctrl+C to stop\n"
miniserve book --port 3000 --index index.html
"""
